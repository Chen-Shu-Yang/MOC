<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link rel="stylesheet" href="./css/babies.css">



    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



    <link href="../css/adminNavbar.css" rel="stylesheet">
    <script src="https://kit.fontawesome.com/ca9c4d369b.js" crossorigin="anonymous"></script>
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'>

    <link href="../css/adminPricing.css" rel="stylesheet">



    <title>Admin Pricing</title>
</head>

<body>

    <div class="row">

        <div class="col-3">
            <div class="sidebar">
                <div class="logo-details">
                    <img src="../img/logo.png">
                    <span class="logo-name">Ministry of Clean</span>
                </div>
                <div class="nav-links">
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-chart-line"></i>
                            <span class="link_name">Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-calendar"></i>
                            <span class="link_name">Booking</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-calendar-xmark"></i>
                            <span class="link_name">Cancellation</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-tags"></i>
                            <span class="link_name">Pricing</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-users"></i>
                            <span class="link_name">Employee</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-clock"></i>
                            <span class="link_name">Schedule</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-user"></i>
                            <span class="link_name">Customer</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-file-signature"></i>
                            <span class="link_name">Contract</span>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <i class="fa-solid fa-id-card"></i>
                            <span class="link_name">Profile</span>
                        </a>
                    </li>
                </div>
            </div>

            <!-- Home Content -->
            <section class="home-section">
                <nav>
                    <div class="sidebar-button">
                        <i class="fa-solid fa-bars sidebarBtn"></i>
                        <span class="page-title">Pricing</span>
                    </div>
                </nav>
            </section>

            <script src="../js/adminNavbar.js"></script>



        </div>
        <!-- Tables -->
        <div class="col-9">

            <!-- Error Message Notification  -->
            <div id="errMsgNotificaton">
            </div>
            <!-- Confiramation Message Notification  -->
            <div id="confirmationMsg">
            </div>

            <!-- All methods needed to connect frontend and backend  -->
            <script>

                //errorToast method display the error
                function errorToast(msg) {
                    // error alert div
                    diverror = `
<div class="alert alert-danger alert-dismissible fade show">
            <strong>Error!</strong>${msg}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    
`
                    //return error alert div
                    return diverror;

                }

                //confirmToast method display confiramtion
                function confirmToast(msg) {
                    //confiramtion alert div
                    divConfirmation = `
<div class="alert alert-success alert-dismissible fade show">
            <strong>${msg}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    
`
                    //return confirmation alert div
                    return divConfirmation;

                }

                //deleteClassOfService method delete class of service
                function deleteClassOfService(id) {


                    // call the web service endpoint for deleting class of service by id
                    $.ajax({

                        url: `http://localhost:5000/class/${id}`,
                        type: 'DELETE',
                        contentType: 'application/json; charset=utf-8',
                        // if data inserted
                        success: function (data, textStatus, xhr) {


                            //if id in the params not valid show error
                            if (xhr.status == 404) {
                                //set and call error message
                                errMsg = "Not valid id"
                                var errMsg = ""
                                $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);
                                //to refresh
                                $('#classServiceTableBody').html('')
                                loadAllClassOfServices()
                            }
                            //if the params id is valid and 
                            else if (xhr.status == 200) {
                                //to refresh
                                $('#classServiceTableBody').html('')
                                loadAllClassOfServices()

                                //set and call confirmation message
                                msg = "Successfully deleted!"

                                $('#confirmationMsg').html(confirmToast(msg + " " + xhr.status)).fadeOut(2500);
                                $('#classServiceTableBody').html('')
                                loadAllClassOfServices()




                            }



                        },

                        error: function (xhr, textStatus, errorThrown) {

                            //set and call error message
                            var errMsg = ""
                            if (xhr.status == 500) {
                                console.log("error")
                                errMsg = "Server Issues"
                            }

                            else {

                                errMsg = "There is some other issues here"

                            }
                            $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);


                        }

                    });




                }

                //updateClassOfService method update class of service
                function updateClassOfService() {

                    //extarct values from pop-up
                    var classId = $('#class-id-update').val();
                    var ClassName = $('#class-name-update').val();
                    var ClassPricing = $('#class-pricing-update').val();
                    var ClassDescription = $('#class-description-update').val();
                    //set value to empty after getting value
                    $('#class_name_add').val("")
                    $('#class_pricing_add').val("")
                    $('#class_description__add').val("")

                    //put all data inserted into data2 so that it can be used to parse as json data in the api
                    var data2 = {
                        "ClassName": ClassName,
                        "ClassPricing": ClassPricing,
                        "ClassDes": ClassDescription
                    }


                    // ajax method to call the method
                    $.ajax({

                        url: 'http://localhost:5000/class/' + classId,
                        type: 'PUT',
                        //data extractex
                        data: JSON.stringify(data2),
                        contentType: "application/json; charset=utf-8",
                        dataType: 'json',
                        success: function (data, textStatus, xhr) {
                            //set and call confirmation message
                            msg = "Successfully updated!"
                            $('#confirmationMsg').html(confirmToast(msg)).fadeOut(2500);
                            //refresh
                            $('#classServiceTableBody').html('')
                            loadAllClassOfServices()

                        },
                        error: function (xhr, textStatus, errorThrown) {
                            //set and call error message
                            var errMsg = ""
                            if (xhr.status == 500) {
                                console.log("error")
                                errMsg = "Please ensure that your values are accurate"
                            }
                            else if (xhr.status == 400) {
                                errMsg = " Invalid input "

                            }
                            else if (xhr.status == 406) {
                                errMsg = " Invalid input"

                            }
                            else {

                                console.log("----------------------------")
                                console.log("error")
                                console.log(xhr.status)

                                console.log("----------------------------")

                                errMsg = "There is some other issues here "

                            }
                            $('#classServiceTableBody').html('')
                            loadAllClassOfServices()
                            $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);

                        }
                    });







                }

                //createTable method is to create the table rows
                function createTable(cardInfo) {
                    console.log(cardInfo);


                    // card html with values to extract when displaying
                    var card = `

 
            <tr>

<td>${cardInfo.classId}</td>
<td>${cardInfo.className}</td>
<td>${cardInfo.classPricing}</td>
<td>${cardInfo.classDes}</td>

<td>

    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#EditClassModal" onClick="loadAClassOfService(${cardInfo.classId})" data-whatever="@mdo"><i class="fa fa-pencil" aria-hidden="true"></i></button>
    


</td>
<td> <button type="button" id="deleteClassServiceBtn" class="btn btn-info"  onClick="deleteClassOfService(${cardInfo.classId})"><i class="fa-regular fa-trash-can"></i></button></td>
</tr>

    



`;


                    //returning card
                    return card;
                }

                //loadAllClassOfServices gets all class of services
                function loadAllClassOfServices() {
                    $.ajax({

                        url: 'http://localhost:5000/classes',
                        type: 'GET',

                        contentType: "application/json; charset=utf-8",

                        success: function (data, textStatus, xhr) {
                            console.log("-------response data------")
                            console.log(data)
                            console.log("LENGTH OF DATA:" + data.length)

                            for (var i = 0; i < data.length; i++) {
                                //assigning variable for classOfService
                                var classOfService = data[i];
                                //extracting information
                                var RowInfo = {
                                    "classId": classOfService.ClassID,
                                    "className": classOfService.ClassName,
                                    "classPricing": classOfService.ClassPricing,
                                    "classDes": classOfService.ClassDes,

                                }

                                console.log("---------Card INfo data pack------------")
                                console.log(RowInfo);
                                //calling createTable to display values row by row
                                var newRow = createTable(RowInfo);
                                //appeding row to classTable
                                $('#classTable').append(newRow);


                            }





                        },

                        error: function (xhr, textStatus, errorThrown) {
                            //print error
                            console.log('Error in Operation');



                        }
                    });





                }



                //loadAClassOfService gets a class of services        
                function loadAClassOfService(id) {

                    // gets a class of service based on id
                    $.ajax({

                        url: 'http://localhost:5000/classes/' + id,
                        type: 'GET',

                        contentType: "application/json; charset=utf-8",

                        success: function (data, textStatus, xhr) {
                            //if the code works
                            console.log("-------response data------")
                            console.log(data)
                            console.log("LENGTH OF DATA:" + data.length)


                            //extract data information
                            var RowInfo = {
                                "classId": data[0].ClassID,
                                "className": data[0].ClassName,
                                "classPricing": data[0].ClassPricing,
                                "classDescription": data[0].ClassDes

                            }

                            console.log("---------Card INfo data pack------------")
                            console.log(RowInfo);
                            console.log("---------------------")


                            //updating extracted values to update pop up
                            $('#class-id-update').val(RowInfo.classId);
                            $('#class-name-update').val(RowInfo.className);
                            $('#class-pricing-update').val(RowInfo.classPricing);
                            $('#class-description-update').val(RowInfo.classDescription);











                        },

                        error: function (xhr, textStatus, errorThrown) {
                            //set and call error message
                            errMsg = " "
                            if (xhr.status == 201) {
                                errMsg = "The id doesn't exist "
                            }
                            $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);



                        }
                    });





                }


                //addClassOfService to add new class of service
                function addClassOfService() {

                    //extract values for add pop-up
                    var name = $('#class_name_add').val();
                    var classPricing = $('#class_pricing_add').val();
                    var classDescription = $('#class_description__add').val();


                    //setting empty string to the fields after adding
                    $('#class_name_add').val("")
                    $('#class_pricing_add').val("")
                    $('#class_description__add').val("")

                    //store all extracted info into requestBody
                    const requestBody = {
                        ClassName: name,
                        ClassPricing: classPricing,
                        ClassDes: classDescription
                    }

                    console.log("request body: " + requestBody)
                    //stringify reqBody
                    const reqBody = JSON.stringify(requestBody)
                    console.log(reqBody)

                    // call the method to post data
                    $.ajax({
                        url: `http://localhost:5000/class`,
                        type: 'POST',
                        data: reqBody,

                        contentType: "application/json; charset=utf-8",

                        dataType: 'json',

                        success: function (data, textStatus, xhr) {


                            //set and call confirmation message

                            msg = "Successfully added!"

                            $('#confirmationMsg').html(confirmToast(msg)).fadeOut(2500);



                            const post = data;

                            $('#classServiceTableBody').html('')
                            loadAllClassOfServices()






                        },
                        error: function (xhr, textStatus, errorThrown) {
                            //set and call error message
                            var errMsg = ""
                            if (xhr.status == 500) {
                                console.log("error")
                                errMsg = "Server Issues"
                            }
                            else if (xhr.status == 400) {
                                errMsg = " Input not accepted"
                            }
                            else if (xhr.status == 406) {
                                errMsg = " Input not accepted"

                            }

                            else {

                                errMsg = "There is some other issues here"

                            }
                            $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(10000);
                            $('#classServiceTableBody').html('')
                            loadAllClassOfServices()


                        }
                    });




                }






                // to load datas when page refresh or loads for the first time
                $(document).ready(function () {

                    // to debug
                    var queryParams = new URLSearchParams(window.location.search);
                    console.log("--------Query Params----------")
                    console.log("Query Param (source): " + window.location.search)
                    console.log("Query Param (extraction): " + queryParams)


                    //load

                    loadAllClassOfServices();


                });





            </script>


 <!-- Card for class of service table  -->
            <dive class="card cardClassService">
                 <!-- Button to add new class of service -->
                <div class=" addBtn">
                    <button type="button" class="btn btn-success  btn-sm" data-toggle="modal"
                        data-target="#AddClassModel" data-whatever="@mdo">Add Service Class</button>

                </div>



                <!-- pop up to add class of service-->
                <div class="modal fade" id="AddClassModel" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">New Class of Service</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">
                                        <h6>Name:</h6>
                                        <input type="text" class="form-control" value="" id="class_name_add">
                                    </div>
                                    <div class="form-group">
                                        <h6>Pricing:</h6>
                                        <input type="text" class="form-control" value="" id="class_pricing_add">
                                    </div>
                                    <div class="form-group">
                                        <h6>Description:</h6>
                                        <input type="text" class="form-control" value="" id="class_description__add">
                                    </div>

                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" data-dismiss="modal"
                                    onClick="addClassOfService()">Add</button>
                            </div>
                        </div>
                    </div>

                </div>


                <!-- pop up to update class of service -->
                <div class="modal fade" id="EditClassModal" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">



                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalLabel">Edit Class of Service </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <form>
                                    <div class="form-group">

                                        <input type="hidden" class="form-control" id="class-id-update">
                                    </div>
                                    <div class="form-group">
                                        <label for="class-name-update" class="col-form-label">Class Name:</label>
                                        <input type="text" class="form-control" id="class-name-update">
                                    </div>
                                    <div class="form-group">
                                        <label for="class-pricing-update" class="col-form-label">Class Pricing:</label>
                                        <input type="text" class="form-control" id="class-pricing-update">
                                    </div>
                                    <div class="form-group">
                                        <label for="class-description-update" class="col-form-label">Class
                                            Description:</label>
                                        <input type="text" class="form-control" id="class-description-update">
                                    </div>





                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="updateClassOfService()"
                                    data-dismiss="modal">Update</button>
                            </div>
                        </div>
                    </div>


                </div>

                 <!-- class of service table -->
                <div class="table-size">
                    <table id="classTable" class="table">
                        <thead>
                            <tr>
                                <th scope="col">Class Id</th>
                                <th scope="col">Class Name</th>
                                <th scope="col">Class Pricing</th>
                                <th scope="col">Class Description</th>
                                <th scope="col">Update</th>
                                <th scope="col">Delete</th>

                            </tr>
                        </thead>
                        <tbody id="classServiceTableBody">



                        </tbody>
                    </table>
                </div>

        </div>

    </div>
    </div>

</body>

</html>