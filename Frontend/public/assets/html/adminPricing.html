<!doctype html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <link rel="stylesheet" href="./css/babies.css">



    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->


    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
        integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
        crossorigin="anonymous"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>

    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>



    <title>Hello, world!</title>
</head>

<body>

    <h1> Babies page</h1>

    <div id="errMsgNotificaton">

    </div>
    <div id="confirmationMsg">

    </div>





    <script>


        function errorToast(msg) {
            diverror = `
<div class="alert alert-danger alert-dismissible fade show">
            <strong>Error!</strong>${msg}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    
`

            return diverror;

        }

        function confirmToast(msg) {
            diverror = `
<div class="alert alert-success alert-dismissible fade show">
            <strong>${msg}</strong>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
    
`

            return diverror;

        }


        function deleteBaby(id) {


            // call the web service endpoint
            $.ajax({

                url: `http://localhost:5000/class/${id}`,
                type: 'DELETE',
                // data: data,
                contentType: 'application/json; charset=utf-8',
                // dataType: 'json',
                success: function (data, textStatus, xhr) {


                    var errMsg = ""
                    if (xhr.status == 404) {
                        console.log("error")
                        errMsg = "Not valid id"
                        $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);
                    }
                    else if (xhr.status == 200) {
                        $('#babyTableBody').html('')
                        loadAllBabies()


                        msg = "Successfully deleted!"

                        $('#confirmationMsg').html(confirmToast(msg + " "+xhr.status)).fadeOut(2500);




                    }



                },

                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error in Operation');

                    console.log(xhr);
                    console.log(textStatus);
                    console.log(errorThrown);

                    console.log(xhr.responseText);
                    console.log(xhr.status);

                    var errMsg = ""
                    if (xhr.status == 500) {
                        console.log("error")
                        errMsg = "Server Issues"
                    }

                    else {

                        errMsg = "There is some other issues here"

                    }
                    $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);


                }

            });




        }


        function updateBaby() {
            var classId = $('#class-id-update').val();
            var ClassName = $('#class-name-update').val();
            var ClassPricing = $('#class-pricing-update').val();
            var ClassDescription = $('#class-description-update').val();
         




            var data2 = {
                "ClassName": ClassName,
                "ClassPricing": ClassPricing,
                "ClassDes": ClassDescription
            }



            $.ajax({

                url: 'http://localhost:5000/class/' + classId,
                type: 'PUT',
                data: JSON.stringify(data2),
                contentType: "application/json; charset=utf-8",
                dataType: 'json',
                success: function (data, textStatus, xhr) {

                    $('#babyTableBody').html('')
                    loadAllBabies()
                    msg = "Successfully updated!"

                    $('#confirmationMsg').html(confirmToast(msg)).fadeOut(2500);




                },
                error: function (xhr, textStatus, errorThrown) {
                    var errMsg = ""
                    if (xhr.status == 500) {
                        console.log("error")
                        errMsg = "Please ensure that your values are accurate"
                    }
                    else if (xhr.status == 400) {
                        errMsg = "Invalid input " + xhr.status

                    }
                    else if (xhr.status == 406) {
                        errMsg = "Innappropraite value " + xhr.status

                    }
                

                    else {

                        console.log("----------------------------")
                        console.log("error")
                        console.log(xhr.status)

                        console.log("----------------------------")

                        errMsg = "There is some other issues here " + xhr.status

                    }
                    $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);

                }
            });







        }


        function createRow(cardInfo) {
            console.log(cardInfo);



            var card = `

 
            <tr>

<td>${cardInfo.classId}</td>
<td>${cardInfo.className}</td>
<td>${cardInfo.classPricing}</td>
<td>${cardInfo.classDes}</td>

<td>

    <button type="button" class="btn btn-warning" data-toggle="modal" data-target="#exampleModal" onClick="loadABaby(${cardInfo.classId})" data-whatever="@mdo">Update${cardInfo.classId}</button>
    


</td>
<td> <button type="button" id="deleteBabyBtn" class="btn btn-danger"  onClick="deleteBaby(${cardInfo.classId})">Delete</button></td>
</tr>

    



`;



            return card;
        }



        function loadAllBabies() {
            $.ajax({

                url: 'http://localhost:5000/classes',
                type: 'GET',

                contentType: "application/json; charset=utf-8",

                success: function (data, textStatus, xhr) {
                    console.log("-------response data------")
                    console.log(data)
                    console.log("LENGTH OF DATA:" + data.length)

                    for (var i = 0; i < data.length; i++) {
                        var classOfService = data[i];

                        var RowInfo = {
                            "classId":classOfService.ClassID ,
                            "className": classOfService.ClassName,
                            "classPricing": classOfService.ClassPricing,
                            "classDes": classOfService.ClassDes,
                           
                        }

                        console.log("---------Card INfo data pack------------")
                        console.log(RowInfo);

                        var newRow = createRow(RowInfo);

                        $('#classTable').append(newRow);


                    }





                },

                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error in Operation');

                    console.log(xhr);
                    console.log(textStatus);
                    console.log(errorThrown);

                    console.log(xhr.responseText);
                    console.log(xhr.status);


                }
            });





        }



        function loadABaby(id) {

            console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")
            console.log("load a baby runs")
            console.log("~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~")
            $.ajax({

                url: 'http://localhost:5000/classes/' + id,
                type: 'GET',

                contentType: "application/json; charset=utf-8",

                success: function (data, textStatus, xhr) {
                    console.log("-------response data------")
                    console.log(data)
                    console.log("LENGTH OF DATA:" + data.length)



                    var RowInfo = {
                        "classId": data[0].ClassID,
                        "className": data[0].ClassName,
                        "classPricing": data[0].ClassPricing,
                        "classDescription": data[0].ClassDes
                      
                    }

                    console.log("---------Card INfo data pack------------")
                    console.log(RowInfo);
                    console.log("---------------------")



                    $('#class-id-update').val(RowInfo.classId);
                    $('#class-name-update').val(RowInfo.className);
                    $('#class-pricing-update').val(RowInfo.classPricing);
                    $('#class-description-update').val(RowInfo.classDescription);
                 


                    $('#babyTableBody').html('')
                    loadAllBabies()








                },

                error: function (xhr, textStatus, errorThrown) {
                    console.log('Error in Operation');
                    errMsg = " "
                    if (xhr.status == 201) {
                        errMsg = "The id doesn't exist "
                    }
                    $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);



                }
            });





        }



        function addBaby() {

            var name = $('#class_name_add').val();
            var classPricing = $('#class_pricing_add').val();
            var classDescription = $('#class_description__add').val();
          


            $('#class_name_add').val("")
            $('#class_pricing__add').val("")
            $('#class_description__add').val("")
         






            const requestBody = {
                ClassName: name,
                ClassPricing: classPricing,
                ClassDes: classDescription
            }

            console.log("request body: "+requestBody)

            const reqBody = JSON.stringify(requestBody)
            console.log(reqBody)

            $.ajax({



                url: `http://localhost:5000/class`,
                type: 'POST',
                data: reqBody,

                contentType: "application/json; charset=utf-8",

                dataType: 'json',

                success: function (data, textStatus, xhr) {




                    msg = "Successfully added!"

                    $('#confirmationMsg').html(confirmToast(msg)).fadeOut(2500);



                    const post = data;

                    $('#babyTableBody').html('')
                    loadAllBabies()






                },
                error: function (xhr, textStatus, errorThrown) {
                    var errMsg = ""
                    if (xhr.status == 500) {
                        console.log("error")
                        errMsg = "Server Issues"
                    }
                    else if (xhr.status == 400) {
                        errMsg = "Null values not allowed"
                    }
                    else if (xhr.status == 406) {
                        errMsg = "Invalid Input"

                    }

                    else {

                        errMsg = "There is some other issues here"

                    }
                    $('#errMsgNotificaton').html(errorToast(errMsg)).fadeOut(2500);

                }
            });




        }







        $(document).ready(function () {


            var queryParams = new URLSearchParams(window.location.search);
            console.log("--------Query Params----------")
            console.log("Query Param (source): " + window.location.search)
            console.log("Query Param (extraction): " + queryParams)




            loadAllBabies();


        });





    </script>

    <button type="button" class="btn btn-success" data-toggle="modal" data-target="#AddModel"
        data-whatever="@mdo">Add</button>





    <!-- pop up for add-->
    <div class="modal fade" id="AddModel" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">New Baby</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <h6>Name:</h6>
                            <input type="text" class="form-control" value="" id="class_name_add">
                        </div>
                        <div class="form-group">
                            <h6>Pricing:</h6>
                            <input type="text" class="form-control" value="" id="class_pricing_add">
                        </div>
                        <div class="form-group">
                            <h6>Description:</h6>
                            <input type="text" class="form-control" value="" id="class_description__add">
                        </div>
                      
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" data-dismiss="modal" onClick="addBaby()">Add</button>
                </div>
            </div>
        </div>

    </div>


    <!-- pop up for update-->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">



        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">New message </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="class-id-update" class="col-form-label">Class Id:</label>
                            <input type="text" class="form-control" id="class-id-update">
                        </div>
                        <div class="form-group">
                            <label for="class-name-update" class="col-form-label">Class Name:</label>
                            <input type="text" class="form-control" id="class-name-update">
                        </div>
                        <div class="form-group">
                            <label for="class-pricing-update" class="col-form-label">Class Pricing:</label>
                            <input type="text" class="form-control" id="class-pricing-update">
                        </div>
                        <div class="form-group">
                            <label for="class-description-update" class="col-form-label">Class Description:</label>
                            <input type="text" class="form-control" id="class-description-update">
                        </div>
                        
                    
                    


                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" onclick="updateBaby()" data-dismiss="modal">Send
                        message</button>
                </div>
            </div>
        </div>


    </div>


    <div class="table-size">
        <table id="classTable" class="table">
            <thead>
                <tr>
                    <th scope="col">Class Id</th>
                    <th scope="col">Class Name</th>
                    <th scope="col">Class Pricing</th>
                    <th scope="col">Class Description</th>
                    <th scope="col">Update</th>
                    <th scope="col">Delete</th>

                </tr>
            </thead>
            <tbody id="babyTableBody">



            </tbody>
        </table>
    </div>




</body>

</html>